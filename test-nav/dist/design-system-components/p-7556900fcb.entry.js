import{h as i,r as s,c as t,H as e,g as a}from"./p-e85eaa4e.js";import{g as l}from"./p-6b2d19d0.js";import{s as h,a as o,i as r,e as n,c as d,d as b}from"./p-785037ba.js";import{L as c}from"./p-585cea76.js";import{c as u,g as p}from"./p-3e8ff66b.js";import{B as f}from"./p-61996a75.js";import{F as m}from"./p-3edac1bb.js";import{d as v}from"./p-ba7c87d4.js";import"./p-9a3d9e17.js";import"./p-add1e9ec.js";var g=u((function(i,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SPECS={si:{radix:1e3,unit:["b","kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"]},iec:{radix:1024,unit:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"]},jedec:{radix:1024,unit:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"]}}}));const j=p(u((function(i,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(i,s,t){void 0===s&&(s=1),i=Math.abs(i);for(var e=g.SPECS[t]||g.SPECS.jedec,a=e.radix,l=e.unit,h=0;i>=a;)i/=a,++h;return i.toFixed(s)+" "+l[h]}}))),F=f.block("file-upload").element("list"),y=({files:s,disabled:t,subTitle:e,onRemoveFile:a})=>i("bal-card",{class:Object.assign({},F.class()),flat:!0},i("bal-list",{disabled:t,border:!0,size:"large"},s.map(((s,l)=>i("bal-list-item",{disabled:t},i("bal-list-item-icon",null,i("bal-icon",{name:"document"})),i("bal-list-item-content",null,i("bal-list-item-title",null,s.name),i("bal-list-item-subtitle",null,e?e(s):j(s.size))),i("bal-list-item-icon",{right:!0,class:{"file-remove":!0,"is-clickable":!t},onClick:i=>a(i,l)},i("bal-icon",{name:"trash",color:t?"grey":"danger"}))))))),k=i=>{const s=new DataTransfer;return i&&i.length>0&&i.forEach((i=>s.items.add(i))),s.files};const C=class{constructor(i){s(this,i),this.balChange=t(this,"balChange",7),this.balFilesAdded=t(this,"balFilesAdded",7),this.balFilesRemoved=t(this,"balFilesRemoved",7),this.balRejectedFile=t(this,"balRejectedFile",7),this.balInputClick=t(this,"balInputClick",7),this.balBlur=t(this,"balBlur",7),this.balFocus=t(this,"balFocus",7),this.fileUploadId="bal-file-upload-"+_++,this.initialValue=this.value||[],this.addEventListenerDragAndDrop=()=>{this.labelEl&&(this.labelEl.addEventListener("dragenter",this.onDragenter,!1),this.labelEl.addEventListener("dragover",this.onDragover,!1),this.labelEl.addEventListener("drop",this.onDrop,!1))},this.removeEventListenerDragAndDrop=()=>{this.labelEl&&(this.labelEl.removeEventListener("dragenter",this.onDragenter,!1),this.labelEl.removeEventListener("dragover",this.onDragover,!1),this.labelEl.removeEventListener("drop",this.onDrop,!1))},this.handleFiles=i=>{const s=Array.from(i||[]),t=((i,s,t)=>{const e=[],a=[...i],l=[];for(let h=0;h<s.length;h++){const o=s[h];if(o){const s=[];t.accept&&-1===t.accept.split(" ").join("").split(",").indexOf(o.type)&&s.push(m.BAD_EXTENSION),void 0!==t.maxFileSize&&o.size>t.maxFileSize&&s.push(m.FILE_TOO_BIG);const h=a.map((i=>i.size)).reduce(((i,s)=>i+s),0);void 0!==t.maxBundleSize&&h+o.size>t.maxBundleSize&&s.push(m.FILE_SIZE_SUM_TOO_BIG),void 0!==t.maxFiles&&a.length+1>t.maxFiles&&s.push(m.TOO_MANY_FILES);const r=(i,s)=>i.size===s.size&&i.name===s.name&&i.type===s.type&&i.lastModified===s.lastModified;i.filter((i=>r(i,o))).length>0&&s.push(m.DUPLICATED_FILE),s.length>0?l.push({file:o,reasons:s}):(a.push(o),e.push(o))}}return{validFiles:e,invalidFiles:l}})(this.files,s,{accept:this.accept,maxFileSize:this.maxFileSize,maxBundleSize:this.maxBundleSize,maxFiles:this.maxFiles});t.invalidFiles.length>0&&this.balRejectedFile.emit(t.invalidFiles[0]),t.validFiles.length>0&&(this.balFilesAdded.emit(t.validFiles),this.files=[...this.files,...t.validFiles],this.balChange.emit(this.files)),this.updateFileInput()},this.updateFileInput=()=>{var i;(null===(i=this.nativeInput)||void 0===i?void 0:i.files)&&(this.nativeInput.files=k(this.files))},this.onDragenter=i=>{h(i)},this.onDragover=i=>{h(i)},this.onDrop=i=>{if(h(i),!this.disabled&&!this.readonly&&!this.loading){const s=i.dataTransfer;s&&this.handleFiles(s.files)}},this.onInputChange=()=>{var i;this.disabled||this.readonly||this.loading||(null===(i=this.nativeInput)||void 0===i?void 0:i.files)&&this.handleFiles(this.nativeInput.files)},this.onRemoveFile=(i,s)=>{if(h(i),s>=0&&s<this.files.length){const i=this.files,t=i.splice(s,1);this.balFilesRemoved.emit(t),this.files=[...i],this.balChange.emit(this.files),this.updateFileInput()}},this.onHostClick=i=>o(this,i),this.onInputFocus=i=>r(this,i),this.onInputBlur=i=>n(this,i),this.onInputClick=i=>{!this.nativeInput||this.disabled||this.readonly||this.loading||(this.nativeInput.value=""),this.balInputClick.emit(i)},this.files=[],this.focused=!1,this.ariaForm=v,this.name=this.fileUploadId,this.value=[],this.label="Choose or drop a file...",this.multiple=!0,this.disabled=!1,this.readonly=!1,this.loading=!1,this.required=!1,this.accept=void 0,this.maxFiles=void 0,this.maxFileSize=void 0,this.maxBundleSize=void 0,this.hasFileList=!0,this.invalid=!1,this.subTitle=void 0}createLogger(i){this.log=i}onValueChange(){l(this.files,this.value)||(this.files=this.value)}componentWillLoad(){this.onValueChange()}connectedCallback(){this.initialValue=this.value||[],this.addEventListenerDragAndDrop()}componentDidLoad(){this.addEventListenerDragAndDrop()}disconnectedCallback(){this.removeEventListenerDragAndDrop()}resetHandler(i){const s=i.target;(null==s?void 0:s.contains(this.el))&&(this.files=[...this.initialValue],clearTimeout(this.resetHandlerTimer),this.resetHandlerTimer=setTimeout((()=>{this.nativeInput&&(this.nativeInput.files=k(this.initialValue))})))}async clear(){this.files=[],this.updateFileInput()}async setFocus(){d(this)}async setBlur(){b(this)}getInputElement(){return Promise.resolve(this.nativeInput)}async setAriaForm(i){this.ariaForm=Object.assign({},i)}render(){const s=this.ariaForm.controlId||this.fileUploadId;return i(e,{onClick:this.onHostClick,"aria-disabled":this.disabled?"true":null,class:{"bal-file-upload":!0}},i("div",{class:{file:!0,"is-disabled":this.disabled||this.readonly||this.loading,"is-danger":this.invalid}},i("label",{htmlFor:s,ref:i=>this.labelEl=i,class:{"file-label":!0,"is-disabled":this.disabled||this.loading||this.readonly}},i("input",{class:"file-input",type:"file",id:s,"aria-labelledby":this.ariaForm.labelId,"aria-describedby":this.ariaForm.messageId,"aria-invalid":!0===this.invalid?"true":"false","aria-disabled":this.disabled?"true":null,name:this.name,multiple:this.multiple,disabled:this.disabled||this.loading||this.readonly,readonly:this.readonly,required:this.required,accept:this.accept,onClick:this.onInputClick,onChange:this.onInputChange,onFocus:this.onInputFocus,onBlur:this.onInputBlur,ref:i=>this.nativeInput=i,"data-testid":"bal-file-upload-input"}),this.loading?i("span",{class:"file-cta"},i("bal-spinner",null)):i("span",{class:"file-cta"},i("span",{class:"file-icon"},i("bal-icon",{name:"upload",size:"medium",color:this.disabled||this.loading||this.readonly?"grey-light":this.invalid?"danger":"blue"})),i("span",{class:"file-label","data-testid":"bal-file-upload-label"},this.label)))),this.hasFileList&&this.files.length>0?i(y,{files:this.files,disabled:this.disabled||this.readonly||this.loading,subTitle:this.subTitle,onRemoveFile:this.onRemoveFile}):"")}get el(){return a(this)}static get watchers(){return{value:["onValueChange"]}}};!function(i,s,t,e){var a,l=arguments.length,h=l<3?s:null===e?e=Object.getOwnPropertyDescriptor(s,t):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(i,s,t,e);else for(var o=i.length-1;o>=0;o--)(a=i[o])&&(h=(l<3?a(h):l>3?a(s,t,h):a(s,t))||h);l>3&&h&&Object.defineProperty(s,t,h)}([c("bal-file-upload")],C.prototype,"createLogger",null);let _=0;C.style={css:".bal-file-upload{display:block;position:static;width:100%}.bal-file-upload .file-label{word-break:break-word;white-space:normal}.bal-file-upload .bal-heading{word-break:break-all}.bal-file-upload__card{margin-top:var(--bal-space-normal)}.bal-file-upload__list{padding:0 !important}"};export{C as bal_file_upload}